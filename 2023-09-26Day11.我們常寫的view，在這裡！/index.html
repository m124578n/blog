<!DOCTYPE html><html class="appearance-auto" lang="ch"><head><meta charset="UTF-8"><title>Day11. 我們常寫的view，在這裡！</title><meta name="description" content="自我實現 自我成長！"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, initial-scale=1"><!-- Google Analytics --><!-- End Google Analytics -->
<!-- Baidu Analytics --><!-- End Baidu Analytics --><link rel="icon" href="/images/favicon.ico"><link rel="stylesheet" href="/style/common/bulma.css"><link rel="stylesheet" href="/style/base.css"><link rel="stylesheet" href="/style/common/helper.css"><script src="/js/common.js"></script><link rel="stylesheet" href="/style/post.css"><link rel="stylesheet" href="/style/themes/highlight-theme-light.css"><link rel="stylesheet" href="/style/common/jquery.fancybox.min.css"><script src="/js/highlight.pack.js"></script><meta name="description" content="前言今天的主題是我們最常在使用的部分，也就是view，django中要回傳response的方法大致可分為兩種，一種是class based，另一種是function based，至於兩種哪個比較好呢，各有好壞也有適合使用的時機，這個之後我們再來看看，而今天主要目的是要把這個view什麼時候被import進去，而我們自己寫的response又怎麼出去，那個地方給找出來～
根據昨天我們已經可以知道所有的request都會送進middleware_chain，而最裡面那層就是找到我們的view然後回傳，大致如下圖

那我們就進去探險吧！！
正題先找到_get_response的位置，會在django.core.hnadlers.base.BaseHandler其中一個function


稍微看一下註解就能知道.."><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Shun Chih's blog" type="application/atom+xml">
</head><body class="is-flex is-flex-direction-column"><header class="header-widget is-flex-shrink-0 is-hidden-mobile"><div class="container is-fullhd is-flex is-justify-content-space-between is-align-items-center is-full-height"><section class="is-hidden-mobile is-flex-shrink-0"><h2><a href="/">Shun Chih's blog</a></h2></section><h3 class="is-hidden-mobile is-family-serif is-full-height is-flex is-align-items-center is-flex-shrink-0"><div class="is-full-height" id="postTopic"><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">Day11. 我們常寫的view，在這裡！</p><p class="is-full-height is-flex-shrink-0 is-flex is-align-items-center is-justify-content-center">返回頂部</p></div></h3><aside class="is-flex-shrink-0"><h3 class="is-inline-block"><a href="/">首頁</a></h3><h3 class="is-inline-block"><a href="/about">關於我</a></h3><h3 class="is-inline-block"><a href="/archives">文章列表</a></h3></aside></div></header><header class="is-flex header-widget is-flex-shrink-0 is-align-items-center is-justify-content-center is-hidden-tablet"><h3 class="is-inline-block"><a href="/">首頁</a></h3><h3 class="is-inline-block"><a href="/about">關於我</a></h3><h3 class="is-inline-block"><a href="/archives">文章列表</a></h3></header><main><main class="container is-max-widescreen content section post-page pt-4 px-4"><div class="columns is-flex-desktop is-justify-content-center is-flex-direction-row-reverse"><div class="column is-3 is-hidden-mobile"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E9%A1%8C"><span class="toc-text">正題</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B5%90%E8%AA%9E"><span class="toc-text">結語</span></a></li></ol></div><div class="column is-9"><header class="my-4"><a href="/tags/django"><i class="tag post-item-tag">django</i></a><a href="/tags/python"><i class="tag post-item-tag">python</i></a><a href="/tags/15th%E9%90%B5%E4%BA%BA%E8%B3%BD"><i class="tag post-item-tag">15th鐵人賽</i></a><a href="/tags/source%20code"><i class="tag post-item-tag">source code</i></a><a href="/tags/web%20framework"><i class="tag post-item-tag">web framework</i></a></header><h1 class="mt-0 mb-1 is-family-serif" id="postTitle">Day11. 我們常寫的view，在這裡！</h1><time class="has-text-grey" datetime="2023-09-26T13:41:59.000Z">2023-09-26</time><article class="mt-2 post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>今天的主題是我們最常在使用的部分，也就是view，django中要回傳response的方法大致可分為兩種，一種是class based，另一種是function based，至於兩種哪個比較好呢，各有好壞也有適合使用的時機，這個之後我們再來看看，而今天主要目的是要把這個view什麼時候被import進去，而我們自己寫的response又怎麼出去，那個地方給找出來～</p>
<p>根據昨天我們已經可以知道所有的request都會送進middleware_chain，而最裡面那層就是找到我們的view然後回傳，大致如下圖</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905n8hgT3VUzc.png"></p>
<p>那我們就進去探險吧！！</p>
<h2 id="正題"><a href="#正題" class="headerlink" title="正題"></a>正題</h2><p>先找到<code>_get_response</code>的位置，會在<code>django.core.hnadlers.base.BaseHandler</code>其中一個function</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905C1PX8NEoC0.png"></p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905sIf7lfl6Bu.png"></p>
<p>稍微看一下註解就能知道我們的目標是沒錯的！<br>接著往裡面看</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/201629059eLEdJBSX9.png"></p>
<p>首先會先看到，<code>self.resolve_request(request)</code>看起來會去處理request，但具體是怎麼處理的呢？</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/201629058oCPtOdkUm.png"></p>
<p>照著程式碼看，也可以很一目瞭然的知道他會去拿<code>resolver</code>之後把request.path丟進去找符合的，來看看誰又是reolver吧！</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/201629059CJOPgrUz5.png"></p>
<p>很直接的就叫做<code>URLResolver</code>了呢，而他的<code>resolve</code>function又做了什麼事呢！？</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905LHKIGsnDY5.png"></p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905J03iOg2v8y.png"></p>
<p>可以看到他會去我們在settings.py中定義的ROOT_URL中找到該py檔案中的urlpatterns，然後跑一個for迴圈去比對，最後回傳一個<code>ResolverMatch</code>物件～<br>最後直接看看return了什麼給我們吧！</p>
<pre><code class="hljs python">ResolverMatch(func=hello_app.views.hello, args=(), kwargs=&#123;&#125;, url_name=<span class="hljs-literal">None</span>, app_names=[], namespaces=[], route=<span class="hljs-string">&#x27;&#x27;</span>)</code></pre>
<p>可以看到他處理完request.path後就會幫我們找到對應的view function回來～<br>找到view function之後呢？</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905omg4FXgU14.png"></p>
<p>會先把他丟給middleware，這邊是middleware如果含有<code>process_view</code>function就會被加到<code>self._view_middleware</code>當中，然後在這邊處理request和view function<br>接著往下</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905wz46KBspO1.png"></p>
<p>首先會先讓view function也就是callback看看需不需要變成原子，直接翻譯怪怪的，進去看看</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905qkqpxXzIfq.png"></p>
<p>這邊應該是有特別設定參數在settings的話可以指定讓view變成原子性的方式<br>那再往下</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905MSsZrCLmVB.png"></p>
<p>到這邊就會去把我們的view function邏輯跑完後得到response啦！<br>接著會去確認response是不是合法的，response亂return的話debug模式大概就可以看到卡這個function</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905ZKVR5bavqv.png"></p>
<p>最後會再去跑一次middleware，如果該middleware含有<code>process_template_response</code></p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/20162905CbRQqRbsLs.png"></p>
<p>至此<code>_get_response</code>大概如下圖</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/2016290542QDKRAGsc.png"></p>
<p>注意！最後的<code>return response</code>還沒完全回出去唷！！<br>別忘了這個是我們的middleware_chain的最裡面，還要一層一層的跑回去，所以我們的middleware流程大致如下圖～</p>
<p><img src="/images/2023-09-26Day11.%E6%88%91%E5%80%91%E5%B8%B8%E5%AF%AB%E7%9A%84view%EF%BC%8C%E5%9C%A8%E9%80%99%E8%A3%A1%EF%BC%81/201629055KAxrVJDQT.png"></p>
<h2 id="結語"><a href="#結語" class="headerlink" title="結語"></a>結語</h2><p>request進來到response出去，django做的事情也不是一般的多，不過透過這次這樣看原始碼，我也更了解了平常寫的urls和view之間的關係～再來要想想明天要寫什麼了～～</p>
</article><section class="jump-container is-flex is-justify-content-space-between my-6"><!-- em is empty placeholder--><a class="button is-default" href="/2023-09-27Day12.%E8%B6%85%E7%B4%9A%E4%BD%BF%E7%94%A8%E8%80%85SuperUser/" title="Day12. 超級使用者 Super User"><i class="iconfont icon-prev mr-2 has-text-grey"></i><span class="has-text-weight-semibold">上一頁: Day12. 超級使用者 Super User</span></a><a class="button is-default" href="/2023-09-25Day10.middlewaremixin/" title="Day10. middleware mixin"><span class="has-text-weight-semibold">下一頁: Day10. middleware mixin</span><i class="iconfont icon-next ml-2 has-text-grey"></i></a></section><article class="mt-6 comment-container"><script async repo="m124578n/blog" src="https://utteranc.es/client.js" issue-term="pathname" theme="preferred-color-scheme"></script></article></div></div></main></main><footer class="is-flex is-flex-direction-column is-align-items-center is-flex-shrink-0 is-family-serif"><section class="sns-container"><!-- Github--><a title="github" target="_blank" rel="noopener nofollow" href="//github.com/m124578n"><i class="iconfont icon-github"></i></a><!-- Ins--><a title="instagram" target="_blank" rel="noopener nofollow" href="//www.instagram.com/m23568n"><i class="iconfont icon-ins"></i></a><!-- RSS--><a title="rss" target="_blank" rel="noopener nofollow" href="/atom.xml"><i class="iconfont icon-rss"></i></a><!-- 知乎--><!-- 领英--><a title="linkedin" target="_blank" rel="noopener nofollow" href="//www.linkedin.com/in/john19980215"><i class="iconfont icon-linkedin"></i></a><!-- 脸书--><a title="facebook" target="_blank" rel="noopener nofollow" href="//www.facebook.com/m23568n"><i class="iconfont icon-tian7_facebook"></i></a></section><p><span>Copyright ©</span><span> Shun Chih 2023</span></p><div class="is-flex is-justify-content-center is-flex-wrap-wrap"><p>Powered by Hexo &verbar;&nbsp;</p><p class="is-flex is-justify-content-center"><a title="Hexo theme author" target="_blank" rel="noopener" href="//github.com/haojen">Theme by Haojen&nbsp;</a></p><div style="margin-top: 2px"><a class="github-button" title="github-button" target="_blank" rel="noopener" href="https://github.com/haojen/hexo-theme-Claudia" data-color-scheme="no-preference: light; light: light; dark: dark;" data-show-count="true"></a></div></div><div><span></span></div></footer><script async defer src="https://buttons.github.io/buttons.js"></script><script src="/js/jquery-3.6.1.min.js"></script><script src="/js/jquery-fancybox.min.js"></script><script src="/js/img_zoom.js"></script><script src="/js/post.js"></script></body></html>